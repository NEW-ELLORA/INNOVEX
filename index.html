<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KrishiSetu - Agriculture Platform</title>
    <script src="/_sdk/element_sdk.js"></script>
    <script src="/_sdk/data_sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            position: relative;
        }
        * {
            box-sizing: border-box;
        }
        html, body {
            height: 100%;
            overflow-x: hidden;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #2d5016 0%, #4a7c2c 50%, #6b9d3e 100%);
            position: relative;
            overflow: hidden;
        }
        .gradient-bg::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: moveBackground 20s linear infinite;
        }
        @keyframes moveBackground {
            0% {
                transform: translate(0, 0);
            }
            100% {
                transform: translate(50px, 50px);
            }
        }
        .gradient-bg-light {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 50%, #a5d6a7 100%);
            position: relative;
            overflow: hidden;
        }
        .gradient-bg-light::after {
            content: 'ðŸŒ¾';
            position: absolute;
            font-size: 100px;
            opacity: 0.05;
            animation: floatCrop 15s ease-in-out infinite;
            pointer-events: none;
        }
        @keyframes floatCrop {
            0%, 100% {
                transform: translate(10%, 10%) rotate(0deg);
                opacity: 0.05;
            }
            50% {
                transform: translate(80%, 80%) rotate(180deg);
                opacity: 0.1;
            }
        }
        .dark-mode {
            background: linear-gradient(135deg, #1a2f0f 0%, #2d4a1e 50%, #3d5a2a 100%);
            color: #e8f5e9;
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(107, 157, 62, 0.2), transparent);
            transition: left 0.5s ease;
        }
        .card:hover::before {
            left: 100%;
        }
        .dark-mode .card {
            background: rgba(45, 80, 22, 0.9);
            color: #e8f5e9;
        }
        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 16px 64px rgba(107, 157, 62, 0.3);
        }
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            position: relative;
            overflow: hidden;
        }
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .btn:active::after {
            width: 300px;
            height: 300px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #4a7c2c 0%, #6b9d3e 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(74, 124, 44, 0.4);
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #3d6623 0%, #5a8c32 100%);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(74, 124, 44, 0.6);
        }
        .btn-secondary {
            background: rgba(107, 157, 62, 0.2);
            color: #2d5016;
            border: 2px solid #6b9d3e;
        }
        .btn-secondary:hover {
            background: rgba(107, 157, 62, 0.4);
            transform: translateY(-2px);
        }
        .dark-mode .btn-secondary {
            background: rgba(107, 157, 62, 0.3);
            color: #a5d6a7;
        }
        .input-field {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #c8e6c9;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            position: relative;
        }
        .dark-mode .input-field {
            background: rgba(45, 80, 22, 0.5);
            border-color: #4a7c2c;
            color: #e8f5e9;
        }
        .input-field:focus {
            outline: none;
            border-color: #6b9d3e;
            box-shadow: 0 0 0 4px rgba(107, 157, 62, 0.2), 0 4px 12px rgba(107, 157, 62, 0.3);
            transform: translateY(-2px);
        }
        .input-field:hover {
            border-color: #a5d6a7;
            box-shadow: 0 2px 8px rgba(107, 157, 62, 0.1);
        }
        .theme-toggle {
            position: relative;
            width: 60px;
            height: 30px;
            background: linear-gradient(135deg, #c8e6c9 0%, #a5d6a7 100%);
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .dark-mode .theme-toggle {
            background: linear-gradient(135deg, #2d5016 0%, #1a2f0f 100%);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .theme-toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: #ffd700;
            border-radius: 50%;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            animation: glow-sun 2s ease-in-out infinite;
        }
        @keyframes glow-sun {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(255, 215, 0, 0.4);
            }
            50% {
                box-shadow: 0 2px 15px rgba(255, 215, 0, 0.8);
            }
        }
        @keyframes glow-moon {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(74, 124, 44, 0.4);
            }
            50% {
                box-shadow: 0 2px 15px rgba(74, 124, 44, 0.8);
            }
        }
        .dark-mode .theme-toggle-slider {
            left: 33px;
            background: linear-gradient(135deg, #4a7c2c 0%, #6b9d3e 100%);
            animation: glow-moon 2s ease-in-out infinite;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }
        .chart-container {
            width: 100%;
            height: 250px;
            position: relative;
        }
        .status-healthy {
            color: #4caf50;
            animation: pulse-green 2s ease-in-out infinite;
        }
        .status-warning {
            color: #ff9800;
            animation: pulse-orange 2s ease-in-out infinite;
        }
        .status-critical {
            color: #f44336;
            animation: pulse-red 1s ease-in-out infinite;
        }
        @keyframes pulse-green {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.2);
            }
        }
        @keyframes pulse-orange {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.3);
            }
        }
        @keyframes pulse-red {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.4);
            }
        }
        .crop-status-icon {
            font-size: 60px;
            animation: rotate-scale 3s ease-in-out infinite;
        }
        @keyframes rotate-scale {
            0%, 100% {
                transform: rotate(0deg) scale(1);
            }
            25% {
                transform: rotate(-10deg) scale(1.1);
            }
            75% {
                transform: rotate(10deg) scale(1.1);
            }
        }
        .chat-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 16px;
            margin-bottom: 12px;
            word-wrap: break-word;
            animation: slideIn 0.4s ease-out;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .chat-bubble:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .chat-bubble-farmer {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        .dark-mode .chat-bubble-farmer {
            background: linear-gradient(135deg, rgba(107, 157, 62, 0.3) 0%, rgba(74, 124, 44, 0.3) 100%);
        }
        .chat-bubble-admin {
            background: linear-gradient(135deg, #6b9d3e 0%, #4a7c2c 100%);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        .loading-spinner {
            border: 4px solid rgba(107, 157, 62, 0.2);
            border-top: 4px solid #6b9d3e;
            border-right: 4px solid #4a7c2c;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 0.8s cubic-bezier(0.5, 0, 0.5, 1) infinite;
            box-shadow: 0 0 20px rgba(107, 157, 62, 0.3);
        }
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        .particle {
            position: absolute;
            font-size: 20px;
            opacity: 0.3;
            animation: float 10s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
                opacity: 0.3;
            }
            50% {
                transform: translateY(-100px) rotate(180deg);
                opacity: 0.6;
            }
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .scroll-container {
            max-height: 400px;
            overflow-y: auto;
        }
        .scroll-container::-webkit-scrollbar {
            width: 8px;
        }
        .scroll-container::-webkit-scrollbar-track {
            background: rgba(200, 230, 201, 0.3);
            border-radius: 4px;
        }
        .scroll-container::-webkit-scrollbar-thumb {
            background: #6b9d3e;
            border-radius: 4px;
        }
        .iot-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(232, 245, 233, 0.9) 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.6s ease-out backwards;
        }
        .iot-card:nth-child(1) {
            animation-delay: 0.1s;
        }
        .iot-card:nth-child(2) {
            animation-delay: 0.2s;
        }
        .iot-card:nth-child(3) {
            animation-delay: 0.3s;
        }
        .iot-card:nth-child(4) {
            animation-delay: 0.4s;
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .dark-mode .iot-card {
            background: linear-gradient(135deg, rgba(45, 80, 22, 0.8) 0%, rgba(61, 90, 42, 0.8) 100%);
        }
        .iot-card:hover {
            transform: scale(1.1) rotate(2deg);
            box-shadow: 0 8px 30px rgba(107, 157, 62, 0.4);
        }
        .iot-card .text-3xl {
            animation: bounce 2s ease-in-out infinite;
        }
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        .language-btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #6b9d3e;
            background: transparent;
        }
        .language-btn.active {
            background: #6b9d3e;
            color: white;
        }
        .chat-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4a7c2c 0%, #6b9d3e 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(74, 124, 44, 0.5);
            transition: all 0.3s ease;
            z-index: 1000;
            animation: pulse-fab 2s ease-in-out infinite;
        }
        @keyframes pulse-fab {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 4px 20px rgba(74, 124, 44, 0.5);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 0 6px 30px rgba(74, 124, 44, 0.8);
            }
        }
        .chat-fab:hover {
            transform: scale(1.15) rotate(10deg);
            box-shadow: 0 6px 30px rgba(74, 124, 44, 0.8);
        }
        .chat-fab-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f44336;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            animation: bounce 1s ease-in-out infinite;
        }
        .chat-modal {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 400px;
            max-width: calc(100vw - 60px);
            max-height: 600px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.3);
            z-index: 999;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease-out;
            overflow: hidden;
        }
        .dark-mode .chat-modal {
            background: #2d5016;
            color: #e8f5e9;
        }
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .chat-modal-header {
            background: linear-gradient(135deg, #4a7c2c 0%, #6b9d3e 100%);
            color: white;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }
        .chat-modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .chat-modal-footer {
            padding: 16px;
            border-top: 2px solid rgba(107, 157, 62, 0.2);
            display: flex;
            gap: 8px;
        }
        .chat-close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .chat-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2d5016 0%, #4a7c2c 50%, #6b9d3e 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .tree-animation {
            width: 200px;
            height: 200px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .seedling-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
        .soil-line {
            position: absolute;
            bottom: 30%;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, transparent, #8b4513, transparent);
            animation: soilAppear 0.3s ease-out forwards;
            opacity: 0;
        }
        @keyframes soilAppear {
            to {
                opacity: 0.7;
            }
        }
        .seed {
            position: absolute;
            bottom: 30%;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 16px;
            background: radial-gradient(circle, #d4a574, #8b6f47);
            border-radius: 50%;
            animation: seedPulse 0.5s ease-in-out 0.3s forwards;
            opacity: 0;
        }
        @keyframes seedPulse {
            0% {
                opacity: 0;
                transform: translateX(-50%) scale(0);
            }
            50% {
                opacity: 1;
                transform: translateX(-50%) scale(1.2);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) scale(1);
            }
        }
        .sprout {
            position: absolute;
            bottom: 30%;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 0;
            background: linear-gradient(to top, #8b4513, #6b4423);
            border-radius: 4px;
            animation: trunkGrow 0.8s ease-out 0.8s forwards;
        }
        @keyframes trunkGrow {
            to {
                height: 100px;
            }
        }
        .first-leaves {
            position: absolute;
            bottom: calc(30% + 100px);
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            animation: canopyAppear 0.6s ease-out 1.6s forwards;
        }
        @keyframes canopyAppear {
            0% {
                opacity: 0;
                transform: translateX(-50%) scale(0);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) scale(1);
            }
        }
        .leaf-left, .leaf-right {
            position: absolute;
            width: 50px;
            height: 40px;
            background: radial-gradient(ellipse at center, #6b9d3e, #4a7c2c);
            border-radius: 50%;
        }
        .leaf-left {
            right: 4px;
            top: -10px;
            animation: leafSway 2s ease-in-out 2.2s infinite;
        }
        .leaf-right {
            left: 4px;
            top: -10px;
            animation: leafSway 2s ease-in-out 2.5s infinite alternate;
        }
        @keyframes leafSway {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-5px);
            }
        }
        .mature-plant {
            position: absolute;
            bottom: calc(30% + 100px);
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            animation: plantMature 0.6s ease-out 2.2s forwards;
        }
        @keyframes plantMature {
            0% {
                opacity: 0;
                transform: translateX(-50%) scale(0.5);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) scale(1);
            }
        }
        .plant-crown {
            position: relative;
            width: 120px;
            height: 80px;
        }
        .crown-leaf {
            position: absolute;
            width: 60px;
            height: 50px;
            background: radial-gradient(ellipse at center, #6b9d3e, #4a7c2c);
            border-radius: 50%;
            transform-origin: center;
        }
        .crown-leaf:nth-child(1) {
            top: 0;
            left: 30px;
            animation: crownGrow 0.4s ease-out 2.8s backwards;
        }
        .crown-leaf:nth-child(2) {
            top: 10px;
            left: 0;
            animation: crownGrow 0.4s ease-out 3s backwards;
        }
        .crown-leaf:nth-child(3) {
            top: 10px;
            right: 0;
            animation: crownGrow 0.4s ease-out 3.2s backwards;
        }
        .crown-leaf:nth-child(4) {
            top: 30px;
            left: 15px;
            animation: crownGrow 0.4s ease-out 3.4s backwards;
        }
        .crown-leaf:nth-child(5) {
            top: 30px;
            right: 15px;
            animation: crownGrow 0.4s ease-out 3.6s backwards;
        }
        @keyframes crownGrow {
            0% {
                opacity: 0;
                transform: scale(0);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        .flower-bloom {
            position: absolute;
            bottom: -15px;
            left: 20%;
            width: 20px;
            height: 20px;
            opacity: 0;
            animation: fruitAppear 0.5s ease-out 4s forwards;
        }
        @keyframes fruitAppear {
            0% {
                opacity: 0;
                transform: translateY(-10px) scale(0);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        .petal {
            position: absolute;
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, #ff6b6b, #c92a2a);
            border-radius: 50%;
            transform-origin: center;
        }
        .petal:nth-child(1) {
            left: 0;
            animation: fruitHang 2s ease-in-out 4.5s infinite;
        }
        .petal:nth-child(2) {
            left: 25px;
            animation: fruitHang 2s ease-in-out 4.7s infinite;
        }
        .petal:nth-child(3) {
            left: 50px;
            animation: fruitHang 2s ease-in-out 4.9s infinite;
        }
        .petal:nth-child(4) {
            left: 75px;
            top: 5px;
            animation: fruitHang 2s ease-in-out 5.1s infinite;
        }
        .petal:nth-child(5) {
            left: 100px;
            animation: fruitHang 2s ease-in-out 5.3s infinite;
        }
        @keyframes fruitHang {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(5px);
            }
        }
        .flower-center {
            position: absolute;
            top: -8px;
            left: 0;
            width: 2px;
            height: 15px;
            background: #8b4513;
        }
        .loading-text {
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin-top: 40px;
            animation: pulse 1.5s ease-in-out infinite;
        }
        .portal-toggle {
            position: relative;
            width: 300px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            display: flex;
            align-items: center;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.3);
            overflow: hidden;
        }
        .portal-toggle-slider {
            position: absolute;
            width: 50%;
            height: 100%;
            background: linear-gradient(135deg, #6b9d3e 0%, #4a7c2c 100%);
            border-radius: 30px;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        .portal-toggle-slider.admin {
            transform: translateX(100%);
        }
        .portal-option {
            flex: 1;
            text-align: center;
            font-weight: bold;
            z-index: 1;
            transition: color 0.3s ease;
            padding: 10px;
            color: rgba(255, 255, 255, 0.6);
        }
        .portal-option.active {
            color: white;
        }
        .language-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .language-btn-small {
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(107, 157, 62, 0.5);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 12px;
        }
        .language-btn-small.active {
            background: #6b9d3e;
            color: white;
            border-color: #6b9d3e;
        }
        .language-dropdown {
            position: relative;
            display: inline-block;
            z-index: 9998;
        }
        .language-dropdown-button {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #6b9d3e;
            background: white;
            color: #2d5016;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .dark-mode .language-dropdown-button {
            background: rgba(45, 80, 22, 0.8);
            color: #e8f5e9;
            border-color: #6b9d3e;
        }
        .language-dropdown-button:hover {
            background: #e8f5e9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(107, 157, 62, 0.3);
        }
        .dark-mode .language-dropdown-button:hover {
            background: rgba(45, 80, 22, 0.95);
        }
        .language-dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: white;
            border: 2px solid #6b9d3e;
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            min-width: 150px;
            max-height: 250px;
            overflow-y: auto;
            display: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .dark-mode .language-dropdown-menu {
            background: #2d5016;
            border-color: #6b9d3e;
        }
        .language-dropdown-menu.open {
            display: block;
        }
        .language-dropdown-menu::-webkit-scrollbar {
            width: 6px;
        }
        .language-dropdown-menu::-webkit-scrollbar-track {
            background: rgba(200, 230, 201, 0.3);
            border-radius: 3px;
        }
        .language-dropdown-menu::-webkit-scrollbar-thumb {
            background: #6b9d3e;
            border-radius: 3px;
        }
        .language-option {
            padding: 10px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #2d5016;
        }
        .dark-mode .language-option {
            color: #e8f5e9;
        }
        .language-option:hover {
            background: #e8f5e9;
        }
        .dark-mode .language-option:hover {
            background: rgba(107, 157, 62, 0.3);
        }
        .language-option.active {
            background: #6b9d3e;
            color: white;
            font-weight: bold;
        }
        .language-option.active:hover {
            background: #5a8c32;
        }
        .helpline-section {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        .helpline-btn {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #6b9d3e;
            background: white;
            color: #2d5016;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            text-decoration: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .dark-mode .helpline-btn {
            background: rgba(45, 80, 22, 0.8);
            color: #e8f5e9;
        }
        .helpline-btn:hover {
            background: #e8f5e9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(107, 157, 62, 0.3);
        }
        .dark-mode .helpline-btn:hover {
            background: rgba(45, 80, 22, 0.95);
        }
        .dark-mode .card h2, .dark-mode .card h3, .dark-mode .card h4, .dark-mode .card p, .dark-mode .card label, .dark-mode .card td, .dark-mode .card th {
            color: #e8f5e9;
        }
        .dark-mode .text-gray-600, .dark-mode .text-gray-500 {
            color: #c8e6c9 !important;
        }
    </style>
    <style>
        @view-transition {
            navigation: auto;
        }
    </style>
</head>
<body>
<div id="app"></div>
<script>
    const defaultConfig = {
        app_title: "KrishiSetu",
        app_tagline: "Empowering Farmers with Technology",
        admin_welcome: "Welcome to Admin Dashboard",
        farmer_welcome: "Welcome to Your Dashboard",
        primary_color: "#4a7c2c",
        secondary_color: "#6b9d3e",
        background_color: "#e8f5e9",
        text_color: "#1a2f0f",
        accent_color: "#ffd700"
    };
    let currentData = [];
    let currentView = 'login';
    let currentPortal = null;
    let currentUser = null;
    let isDarkMode = false;
    let currentLanguage = 'en';
    let iotInterval = null;
    let isChatOpen = false;
    let loginPortalType = 'farmer';
    let isLoading = false;
    const translations = {
        en: {
            login: "Login",
            adminPortal: "Admin Portal",
            farmerPortal: "Farmer Portal",
            enterDAN: "Enter 12-digit DAN",
            dashboard: "Dashboard",
            addFarmer: "Add Farmer",
            allFarmers: "All Farmers",
            chatSupport: "Chat Support",
            logout: "Logout",
            name: "Name",
            age: "Age",
            contact: "Contact",
            location: "Location",
            plotId: "Plot ID",
            area: "Area (acres)",
            cropType: "Crop Type",
            soilType: "Soil Type",
            irrigation: "Irrigation Method",
            soilMoisture: "Soil Moisture",
            temperature: "Temperature",
            humidity: "Humidity",
            pH: "pH Level",
            save: "Save",
            cancel: "Cancel",
            search: "Search by DAN",
            cropCondition: "Crop Condition",
            healthy: "Healthy",
            needsAttention: "Needs Attention",
            critical: "Critical",
            sendMessage: "Send Message",
            typeMessage: "Type your message...",
            noMessages: "No messages yet",
            reply: "Reply",
            settings: "Settings",
            darkMode: "Dark Mode",
            language: "Language",
            password: "Password",
            enterPassword: "Enter admin password",
            marketplace: "Marketplace",
            news: "News",
            sellYourGoods: "Sell Your Goods",
            buyGoods: "Buy Goods",
            productName: "Product Name",
            price: "Price",
            description: "Description",
            uploadPhoto: "Upload Photo",
            postAd: "Post Advertisement",
            latestNews: "Latest News",
            readMore: "Read More"
        },
        hi: {
            login: "à¤²à¥‰à¤—à¤¿à¤¨",
            adminPortal: "à¤ªà¥à¤°à¤¶à¤¾à¤¸à¤• à¤ªà¥‹à¤°à¥à¤Ÿà¤²",
            farmerPortal: "à¤•à¤¿à¤¸à¤¾à¤¨ à¤ªà¥‹à¤°à¥à¤Ÿà¤²",
            enterDAN: "12 à¤…à¤‚à¤•à¥‹à¤‚ à¤•à¤¾ DAN à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚",
            dashboard: "à¤¡à¥ˆà¤¶à¤¬à¥‹à¤°à¥à¤¡",
            addFarmer: "à¤•à¤¿à¤¸à¤¾à¤¨ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚",
            allFarmers: "à¤¸à¤­à¥€ à¤•à¤¿à¤¸à¤¾à¤¨",
            chatSupport: "à¤šà¥ˆà¤Ÿ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾",
            logout: "à¤²à¥‰à¤—à¤†à¤‰à¤Ÿ",
            name: "à¤¨à¤¾à¤®",
            age: "à¤†à¤¯à¥",
            contact: "à¤¸à¤‚à¤ªà¤°à¥à¤•",
            location: "à¤¸à¥à¤¥à¤¾à¤¨",
            plotId: "à¤ªà¥à¤²à¥‰à¤Ÿ à¤†à¤ˆà¤¡à¥€",
            area: "à¤•à¥à¤·à¥‡à¤¤à¥à¤°à¤«à¤² (à¤à¤•à¤¡à¤¼)",
            cropType: "à¤«à¤¸à¤² à¤•à¤¾ à¤ªà¥à¤°à¤•à¤¾à¤°",
            soilType: "à¤®à¤¿à¤Ÿà¥à¤Ÿà¥€ à¤•à¤¾ à¤ªà¥à¤°à¤•à¤¾à¤°",
            irrigation: "à¤¸à¤¿à¤‚à¤šà¤¾à¤ˆ à¤µà¤¿à¤§à¤¿",
            soilMoisture: "à¤®à¤¿à¤Ÿà¥à¤Ÿà¥€ à¤•à¥€ à¤¨à¤®à¥€",
            temperature: "à¤¤à¤¾à¤ªà¤®à¤¾à¤¨",
            humidity: "à¤†à¤°à¥à¤¦à¥à¤°à¤¤à¤¾",
            pH: "pH à¤¸à¥à¤¤à¤°",
            save: "à¤¸à¤¹à¥‡à¤œà¥‡à¤‚",
            cancel: "à¤°à¤¦à¥à¤¦ à¤•à¤°à¥‡à¤‚",
            search: "DAN à¤¸à¥‡ à¤–à¥‹à¤œà¥‡à¤‚",
            cropCondition: "à¤«à¤¸à¤² à¤•à¥€ à¤¸à¥à¤¥à¤¿à¤¤à¤¿",
            healthy: "à¤¸à¥à¤µà¤¸à¥à¤¥",
            needsAttention: "à¤§à¥à¤¯à¤¾à¤¨ à¤šà¤¾à¤¹à¤¿à¤",
            critical: "à¤—à¤‚à¤­à¥€à¤°",
            sendMessage: "à¤¸à¤‚à¤¦à¥‡à¤¶ à¤­à¥‡à¤œà¥‡à¤‚",
            typeMessage: "à¤…à¤ªà¤¨à¤¾ à¤¸à¤‚à¤¦à¥‡à¤¶ à¤²à¤¿à¤–à¥‡à¤‚...",
            noMessages: "à¤…à¤­à¥€ à¤¤à¤• à¤•à¥‹à¤ˆ à¤¸à¤‚à¤¦à¥‡à¤¶ à¤¨à¤¹à¥€à¤‚",
            reply: "à¤œà¤µà¤¾à¤¬ à¤¦à¥‡à¤‚",
            settings: "à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸",
            darkMode: "à¤¡à¤¾à¤°à¥à¤• à¤®à¥‹à¤¡",
            language: "à¤­à¤¾à¤·à¤¾",
            password: "à¤ªà¤¾à¤¸à¤µà¤°à¥à¤¡",
            enterPassword: "à¤ªà¥à¤°à¤¶à¤¾à¤¸à¤• à¤ªà¤¾à¤¸à¤µà¤°à¥à¤¡ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚",
            marketplace: "à¤¬à¤¾à¤œà¤¾à¤°",
            news: "à¤¸à¤®à¤¾à¤šà¤¾à¤°",
            sellYourGoods: "à¤…à¤ªà¤¨à¤¾ à¤®à¤¾à¤² à¤¬à¥‡à¤šà¥‡à¤‚",
            buyGoods: "à¤®à¤¾à¤² à¤–à¤°à¥€à¤¦à¥‡à¤‚",
            productName: "à¤‰à¤¤à¥à¤ªà¤¾à¤¦ à¤•à¤¾ à¤¨à¤¾à¤®",
            price: "à¤•à¥€à¤®à¤¤",
            description: "à¤µà¤¿à¤µà¤°à¤£",
            uploadPhoto: "à¤«à¥‹à¤Ÿà¥‹ à¤…à¤ªà¤²à¥‹à¤¡ à¤•à¤°à¥‡à¤‚",
            postAd: "à¤µà¤¿à¤œà¥à¤žà¤¾à¤ªà¤¨ à¤ªà¥‹à¤¸à¥à¤Ÿ à¤•à¤°à¥‡à¤‚",
            latestNews: "à¤¤à¤¾à¤œà¤¼à¤¾ à¤–à¤¬à¤°",
            readMore: "à¤”à¤° à¤ªà¤¢à¤¼à¥‡à¤‚"
        },
        kn: {
            login: "à²²à²¾à²—à²¿à²¨à³",
            adminPortal: "à²¨à²¿à²°à³à²µà²¾à²¹à²• à²ªà³‹à²°à³à²Ÿà²²à³",
            farmerPortal: "à²°à³ˆà²¤ à²ªà³‹à²°à³à²Ÿà²²à³",
            enterDAN: "12 à²…à²‚à²•à²¿à²¯ DAN à²¨à²®à³‚à²¦à²¿à²¸à²¿",
            dashboard: "à²¡à³à²¯à²¾à²¶à³â€Œà²¬à³‹à²°à³à²¡à³",
            addFarmer: "à²°à³ˆà²¤à²°à²¨à³à²¨à³ à²¸à³‡à²°à²¿à²¸à²¿",
            allFarmers: "à²Žà²²à³à²²à²¾ à²°à³ˆà²¤à²°à³",
            chatSupport: "à²šà²¾à²Ÿà³ à²¬à³†à²‚à²¬à²²",
            logout: "à²²à²¾à²—à³à²”à²Ÿà³",
            name: "à²¹à³†à²¸à²°à³",
            age: "à²µà²¯à²¸à³à²¸à³",
            contact: "à²¸à²‚à²ªà²°à³à²•",
            location: "à²¸à³à²¥à²³",
            plotId: "à²ªà³à²²à²¾à²Ÿà³ ID",
            area: "à²µà²¿à²¸à³à²¤à³€à²°à³à²£ (à²Žà²•à²°à³†)",
            cropType: "à²¬à³†à²³à³† à²ªà³à²°à²•à²¾à²°",
            soilType: "à²®à²£à³à²£à²¿à²¨ à²ªà³à²°à²•à²¾à²°",
            irrigation: "à²¨à³€à²°à²¾à²µà²°à²¿ à²µà²¿à²§à²¾à²¨",
            soilMoisture: "à²®à²£à³à²£à²¿à²¨ à²¤à³‡à²µà²¾à²‚à²¶",
            temperature: "à²¤à²¾à²ªà²®à²¾à²¨",
            humidity: "à²†à²°à³à²¦à³à²°à²¤à³†",
            pH: "pH à²®à²Ÿà³à²Ÿ",
            save: "à²‰à²³à²¿à²¸à²¿",
            cancel: "à²°à²¦à³à²¦à³à²®à²¾à²¡à²¿",
            search: "DAN à²®à³‚à²²à²• à²¹à³à²¡à³à²•à²¿",
            cropCondition: "à²¬à³†à²³à³† à²¸à³à²¥à²¿à²¤à²¿",
            healthy: "à²†à²°à³‹à²—à³à²¯à²•à²°",
            needsAttention: "à²—à²®à²¨ à²¬à³‡à²•à³",
            critical: "à²¨à²¿à²°à³à²£à²¾à²¯à²•",
            sendMessage: "à²¸à²‚à²¦à³‡à²¶ à²•à²³à³à²¹à²¿à²¸à²¿",
            typeMessage: "à²¨à²¿à²®à³à²® à²¸à²‚à²¦à³‡à²¶à²µà²¨à³à²¨à³ à²Ÿà³ˆà²ªà³ à²®à²¾à²¡à²¿...",
            noMessages: "à²‡à²¨à³à²¨à³‚ à²¯à²¾à²µà³à²¦à³‡ à²¸à²‚à²¦à³‡à²¶à²—à²³à²¿à²²à³à²²",
            reply: "à²‰à²¤à³à²¤à²°à²¿à²¸à²¿",
            settings: "à²¸à³†à²Ÿà³à²Ÿà²¿à²‚à²—à³â€Œà²—à²³à³",
            darkMode: "à²¡à²¾à²°à³à²•à³ à²®à³‹à²¡à³",
            language: "à²­à²¾à²·à³†",
            password: "à²ªà²¾à²¸à³â€Œà²µà²°à³à²¡à³",
            enterPassword: "à²¨à²¿à²°à³à²µà²¾à²¹à²• à²ªà²¾à²¸à³â€Œà²µà²°à³à²¡à³ à²¨à²®à³‚à²¦à²¿à²¸à²¿",
            marketplace: "à²®à²¾à²°à³à²•à²Ÿà³à²Ÿà³†",
            news: "à²¸à³à²¦à³à²¦à²¿",
            sellYourGoods: "à²¨à²¿à²®à³à²® à²¸à²°à²•à³à²—à²³à²¨à³à²¨à³ à²®à²¾à²°à²¾à²Ÿ à²®à²¾à²¡à²¿",
            buyGoods: "à²¸à²°à²•à³à²—à²³à²¨à³à²¨à³ à²–à²°à³€à²¦à²¿à²¸à²¿",
            productName: "à²‰à²¤à³à²ªà²¨à³à²¨à²¦ à²¹à³†à²¸à²°à³",
            price: "à²¬à³†à²²à³†",
            description: "à²µà²¿à²µà²°à²£à³†",
            uploadPhoto: "à²«à³‹à²Ÿà³‹ à²…à²ªà³à²²à³‹à²¡à³ à²®à²¾à²¡à²¿",
            postAd: "à²œà²¾à²¹à³€à²°à²¾à²¤à²¨à³à²¨à³ à²ªà³‹à²¸à³à²Ÿà³ à²®à²¾à²¡à²¿",
            latestNews: "à²‡à²¤à³à²¤à³€à²šà²¿à²¨ à²¸à³à²¦à³à²¦à²¿",
            readMore: "à²®à²¤à³à²¤à²·à³à²Ÿà³ à²“à²¦à²¿"
        },
        ml: {
            login: "à´²àµ‹à´—à´¿àµ»",
            adminPortal: "à´…à´¡àµà´®à´¿àµ» à´ªàµ‹àµ¼à´Ÿàµà´Ÿàµ½",
            farmerPortal: "à´•àµ¼à´·à´• à´ªàµ‹àµ¼à´Ÿàµà´Ÿàµ½",
            enterDAN: "12 à´…à´•àµà´• DAN à´¨àµ½à´•àµà´•",
            dashboard: "à´¡à´¾à´·àµâ€Œà´¬àµ‹àµ¼à´¡àµ",
            addFarmer: "à´•àµ¼à´·à´•à´¨àµ† à´šàµ‡àµ¼à´•àµà´•àµà´•",
            allFarmers: "à´Žà´²àµà´²à´¾ à´•àµ¼à´·à´•à´°àµà´‚",
            chatSupport: "à´šà´¾à´±àµà´±àµ à´ªà´¿à´¨àµà´¤àµà´£",
            logout: "à´²àµ‹à´—àµ—à´Ÿàµà´Ÿàµ",
            name: "à´ªàµ‡à´°àµ",
            age: "à´ªàµà´°à´¾à´¯à´‚",
            contact: "à´¬à´¨àµà´§à´ªàµà´ªàµ†à´Ÿàµà´•",
            location: "à´¸àµà´¥à´²à´‚",
            plotId: "à´ªàµà´²àµ‹à´Ÿàµà´Ÿàµ ID",
            area: "à´µà´¿à´¸àµà´¤àµ€àµ¼à´£àµà´£à´‚ (à´à´•àµà´•àµ¼)",
            cropType: "à´µà´¿à´³ à´¤à´°à´‚",
            soilType: "à´®à´£àµà´£à´¿à´¨àµà´±àµ† à´¤à´°à´‚",
            irrigation: "à´œà´²à´¸àµ‡à´šà´¨ à´°àµ€à´¤à´¿",
            soilMoisture: "à´®à´£àµà´£à´¿à´²àµ† à´ˆàµ¼à´ªàµà´ªà´‚",
            temperature: "à´¤à´¾à´ªà´¨à´¿à´²",
            humidity: "à´†àµ¼à´¦àµà´°à´¤",
            pH: "pH à´¨à´¿à´²",
            save: "à´¸à´‚à´°à´•àµà´·à´¿à´•àµà´•àµà´•",
            cancel: "à´±à´¦àµà´¦à´¾à´•àµà´•àµà´•",
            search: "DAN à´µà´´à´¿ à´¤à´¿à´°à´¯àµà´•",
            cropCondition: "à´µà´¿à´³ à´…à´µà´¸àµà´¥",
            healthy: "à´†à´°àµ‹à´—àµà´¯à´•à´°à´‚",
            needsAttention: "à´¶àµà´°à´¦àµà´§ à´†à´µà´¶àµà´¯à´®à´¾à´£àµ",
            critical: "à´¨à´¿àµ¼à´£à´¾à´¯à´•à´‚",
            sendMessage: "à´¸à´¨àµà´¦àµ‡à´¶à´‚ à´…à´¯à´¯àµà´•àµà´•àµà´•",
            typeMessage: "à´¨à´¿à´™àµà´™à´³àµà´Ÿàµ† à´¸à´¨àµà´¦àµ‡à´¶à´‚ à´Ÿàµˆà´ªàµà´ªàµ à´šàµ†à´¯àµà´¯àµà´•...",
            noMessages: "à´‡à´¤àµà´µà´°àµ† à´¸à´¨àµà´¦àµ‡à´¶à´™àµà´™à´³àµŠà´¨àµà´¨àµà´®à´¿à´²àµà´²",
            reply: "à´®à´±àµà´ªà´Ÿà´¿",
            settings: "à´•àµà´°à´®àµ€à´•à´°à´£à´™àµà´™àµ¾",
            darkMode: "à´¡à´¾àµ¼à´•àµà´•àµ à´®àµ‹à´¡àµ",
            language: "à´­à´¾à´·",
            password: "à´ªà´¾à´¸àµâ€Œà´µàµ‡à´¡àµ",
            enterPassword: "à´…à´¡àµà´®à´¿àµ» à´ªà´¾à´¸àµâ€Œà´µàµ‡à´¡àµ à´¨àµ½à´•àµà´•",
            marketplace: "à´šà´¨àµà´¤",
            news: "à´µà´¾àµ¼à´¤àµà´¤à´•àµ¾",
            sellYourGoods: "à´¨à´¿à´™àµà´™à´³àµà´Ÿàµ† à´¸à´¾à´§à´¨à´™àµà´™àµ¾ à´µà´¿àµ½à´•àµà´•àµà´•",
            buyGoods: "à´¸à´¾à´§à´¨à´™àµà´™àµ¾ à´µà´¾à´™àµà´™àµà´•",
            productName: "à´‰àµ½à´ªàµà´ªà´¨àµà´¨à´¤àµà´¤à´¿àµ»àµà´±àµ† à´ªàµ‡à´°àµ",
            price: "à´µà´¿à´²",
            description: "à´µà´¿à´µà´°à´£à´‚",
            uploadPhoto: "à´«àµ‹à´Ÿàµà´Ÿàµ‹ à´…à´ªàµà´²àµ‹à´¡àµ à´šàµ†à´¯àµà´¯àµà´•",
            postAd: "à´ªà´°à´¸àµà´¯à´‚ à´ªàµ‹à´¸àµà´±àµà´±àµ à´šàµ†à´¯àµà´¯àµà´•",
            latestNews: "à´ªàµà´¤à´¿à´¯ à´µà´¾àµ¼à´¤àµà´¤à´•àµ¾",
            readMore: "à´•àµ‚à´Ÿàµà´¤àµ½ à´µà´¾à´¯à´¿à´•àµà´•àµà´•"
        },
        ta: {
            login: "à®‰à®³à¯à®¨à¯à®´à¯ˆà®¯",
            adminPortal: "à®¨à®¿à®°à¯à®µà®¾à®• à®ªà¯‹à®°à¯à®Ÿà¯à®Ÿà®²à¯",
            farmerPortal: "à®µà®¿à®µà®šà®¾à®¯à®¿ à®ªà¯‹à®°à¯à®Ÿà¯à®Ÿà®²à¯",
            enterDAN: "12 à®‡à®²à®•à¯à®• DAN à®‰à®³à¯à®³à®¿à®Ÿà®µà¯à®®à¯",
            dashboard: "à®Ÿà®¾à®·à¯à®ªà¯‹à®°à¯à®Ÿà¯",
            addFarmer: "à®µà®¿à®µà®šà®¾à®¯à®¿à®¯à¯ˆà®šà¯ à®šà¯‡à®°à¯à®•à¯à®•à®µà¯à®®à¯",
            allFarmers: "à®…à®©à¯ˆà®¤à¯à®¤à¯ à®µà®¿à®µà®šà®¾à®¯à®¿à®•à®³à¯",
            chatSupport: "à®…à®°à®Ÿà¯à®Ÿà¯ˆ à®†à®¤à®°à®µà¯",
            logout: "à®µà¯†à®³à®¿à®¯à¯‡à®±à¯",
            name: "à®ªà¯†à®¯à®°à¯",
            age: "à®µà®¯à®¤à¯",
            contact: "à®¤à¯Šà®Ÿà®°à¯à®ªà¯",
            location: "à®‡à®Ÿà®®à¯",
            plotId: "à®¨à®¿à®²à®®à¯ ID",
            area: "à®ªà®°à®ªà¯à®ªà®³à®µà¯ (à®à®•à¯à®•à®°à¯)",
            cropType: "à®ªà®¯à®¿à®°à¯ à®µà®•à¯ˆ",
            soilType: "à®®à®£à¯ à®µà®•à¯ˆ",
            irrigation: "à®¨à¯€à®°à¯à®ªà¯à®ªà®¾à®šà®© à®®à¯à®±à¯ˆ",
            soilMoisture: "à®®à®£à¯ à®ˆà®°à®ªà¯à®ªà®¤à®®à¯",
            temperature: "à®µà¯†à®ªà¯à®ªà®¨à®¿à®²à¯ˆ",
            humidity: "à®ˆà®°à®ªà¯à®ªà®¤à®®à¯",
            pH: "pH à®¨à®¿à®²à¯ˆ",
            save: "à®šà¯‡à®®à®¿",
            cancel: "à®°à®¤à¯à®¤à¯à®šà¯†à®¯à¯",
            search: "DAN à®®à¯‚à®²à®®à¯ à®¤à¯‡à®Ÿà¯",
            cropCondition: "à®ªà®¯à®¿à®°à¯ à®¨à®¿à®²à¯ˆ",
            healthy: "à®†à®°à¯‹à®•à¯à®•à®¿à®¯à®®à®¾à®©",
            needsAttention: "à®•à®µà®©à®®à¯ à®¤à¯‡à®µà¯ˆ",
            critical: "à®®à¯à®•à¯à®•à®¿à®¯à®®à®¾à®©",
            sendMessage: "à®šà¯†à®¯à¯à®¤à®¿ à®…à®©à¯à®ªà¯à®ªà¯",
            typeMessage: "à®‰à®™à¯à®•à®³à¯ à®šà¯†à®¯à¯à®¤à®¿à®¯à¯ˆ à®¤à®Ÿà¯à®Ÿà®šà¯à®šà¯ à®šà¯†à®¯à¯à®¯à®µà¯à®®à¯...",
            noMessages: "à®‡à®©à¯à®©à¯à®®à¯ à®šà¯†à®¯à¯à®¤à®¿à®•à®³à¯ à®‡à®²à¯à®²à¯ˆ",
            reply: "à®ªà®¤à®¿à®²à¯",
            settings: "à®…à®®à¯ˆà®ªà¯à®ªà¯à®•à®³à¯",
            darkMode: "à®‡à®°à¯à®£à¯à®Ÿ à®ªà®¯à®©à¯à®®à¯à®±à¯ˆ",
            language: "à®®à¯Šà®´à®¿",
            password: "à®•à®Ÿà®µà¯à®šà¯à®šà¯Šà®²à¯",
            enterPassword: "à®¨à®¿à®°à¯à®µà®¾à®• à®•à®Ÿà®µà¯à®šà¯à®šà¯Šà®²à¯à®²à¯ˆ à®‰à®³à¯à®³à®¿à®Ÿà®µà¯à®®à¯",
            marketplace: "à®šà®¨à¯à®¤à¯ˆ",
            news: "à®šà¯†à®¯à¯à®¤à®¿à®•à®³à¯",
            sellYourGoods: "à®‰à®™à¯à®•à®³à¯ à®ªà¯Šà®°à¯à®Ÿà¯à®•à®³à¯ˆ à®µà®¿à®±à¯à®•à®µà¯à®®à¯",
            buyGoods: "à®ªà¯Šà®°à¯à®Ÿà¯à®•à®³à¯ˆ à®µà®¾à®™à¯à®•à®µà¯à®®à¯",
            productName: "à®ªà¯Šà®°à¯à®³à¯ à®ªà¯†à®¯à®°à¯",
            price: "à®µà®¿à®²à¯ˆ",
            description: "à®µà®¿à®³à®•à¯à®•à®®à¯",
            uploadPhoto: "à®ªà¯à®•à¯ˆà®ªà¯à®ªà®Ÿà®¤à¯à®¤à¯ˆà®ªà¯ à®ªà®¤à®¿à®µà¯‡à®±à¯à®±à®µà¯à®®à¯",
            postAd: "à®µà®¿à®³à®®à¯à®ªà®°à®¤à¯à®¤à¯ˆ à®‡à®Ÿà¯à®•à¯ˆà®¯à®¿à®Ÿà®µà¯à®®à¯",
            latestNews: "à®šà®®à¯€à®ªà®¤à¯à®¤à®¿à®¯ à®šà¯†à®¯à¯à®¤à®¿à®•à®³à¯",
            readMore: "à®®à¯‡à®²à¯à®®à¯ à®ªà®Ÿà®¿à®•à¯à®•"
        },
        te: {
            login: "à°²à°¾à°—à°¿à°¨à±",
            adminPortal: "à°…à°¡à±à°®à°¿à°¨à± à°ªà±‹à°°à±à°Ÿà°²à±",
            farmerPortal: "à°°à±ˆà°¤à± à°ªà±‹à°°à±à°Ÿà°²à±",
            enterDAN: "12 à°…à°‚à°•à±†à°² DAN à°¨à°®à±‹à°¦à± à°šà±‡à°¯à°‚à°¡à°¿",
            dashboard: "à°¡à°¾à°·à±â€Œà°¬à±‹à°°à±à°¡à±",
            addFarmer: "à°°à±ˆà°¤à±à°¨à± à°œà±‹à°¡à°¿à°‚à°šà°‚à°¡à°¿",
            allFarmers: "à°…à°¨à±à°¨à°¿ à°°à±ˆà°¤à±à°²à±",
            chatSupport: "à°šà°¾à°Ÿà± à°®à°¦à±à°¦à°¤à±",
            logout: "à°²à°¾à°—à±à°…à°µà±à°Ÿà±",
            name: "à°ªà±‡à°°à±",
            age: "à°µà°¯à°¸à±à°¸à±",
            contact: "à°¸à°‚à°ªà±à°°à°¦à°¿à°‚à°šà°‚à°¡à°¿",
            location: "à°¸à±à°¥à°¾à°¨à°‚",
            plotId: "à°ªà±à°²à°¾à°Ÿà± ID",
            area: "à°µà°¿à°¸à±à°¤à±€à°°à±à°£à°‚ (à°Žà°•à°°à°¾à°²à±)",
            cropType: "à°ªà°‚à°Ÿ à°°à°•à°‚",
            soilType: "à°¨à±‡à°² à°°à°•à°‚",
            irrigation: "à°¨à±€à°Ÿà°¿à°ªà°¾à°°à±à°¦à°² à°ªà°¦à±à°§à°¤à°¿",
            soilMoisture: "à°¨à±‡à°² à°¤à±‡à°®",
            temperature: "à°‰à°·à±à°£à±‹à°—à±à°°à°¤",
            humidity: "à°¤à±‡à°®",
            pH: "pH à°¸à±à°¥à°¾à°¯à°¿",
            save: "à°¸à±‡à°µà± à°šà±‡à°¯à°‚à°¡à°¿",
            cancel: "à°°à°¦à±à°¦à± à°šà±‡à°¯à°‚à°¡à°¿",
            search: "DAN à°¦à±à°µà°¾à°°à°¾ à°¶à±‹à°§à°¿à°‚à°šà°‚à°¡à°¿",
            cropCondition: "à°ªà°‚à°Ÿ à°ªà°°à°¿à°¸à±à°¥à°¿à°¤à°¿",
            healthy: "à°†à°°à±‹à°—à±à°¯à°•à°°à°®à±ˆà°¨",
            needsAttention: "à°¶à±à°°à°¦à±à°§ à°…à°µà°¸à°°à°‚",
            critical: "à°•à±à°²à°¿à°·à±à°Ÿà°®à±ˆà°¨",
            sendMessage: "à°¸à°‚à°¦à±‡à°¶à°‚ à°ªà°‚à°ªà°‚à°¡à°¿",
            typeMessage: "à°®à±€ à°¸à°‚à°¦à±‡à°¶à°¾à°¨à±à°¨à°¿ à°Ÿà±ˆà°ªà± à°šà±‡à°¯à°‚à°¡à°¿...",
            noMessages: "à°‡à°‚à°•à°¾ à°¸à°‚à°¦à±‡à°¶à°¾à°²à± à°²à±‡à°µà±",
            reply: "à°¸à°®à°¾à°§à°¾à°¨à°‚",
            settings: "à°¸à±†à°Ÿà±à°Ÿà°¿à°‚à°—à±â€Œà°²à±",
            darkMode: "à°¡à°¾à°°à±à°•à± à°®à±‹à°¡à±",
            language: "à°­à°¾à°·",
            password: "à°ªà°¾à°¸à±â€Œà°µà°°à±à°¡à±",
            enterPassword: "à°…à°¡à±à°®à°¿à°¨à± à°ªà°¾à°¸à±â€Œà°µà°°à±à°¡à± à°¨à°®à±‹à°¦à± à°šà±‡à°¯à°‚à°¡à°¿",
            marketplace: "à°®à°¾à°°à±à°•à±†à°Ÿà±",
            news: "à°µà°¾à°°à±à°¤à°²à±",
            sellYourGoods: "à°®à±€ à°µà°¸à±à°¤à±à°µà±à°²à°¨à± à°…à°®à±à°®à°‚à°¡à°¿",
            buyGoods: "à°µà°¸à±à°¤à±à°µà±à°²à± à°•à±Šà°¨à°‚à°¡à°¿",
            productName: "à°‰à°¤à±à°ªà°¤à±à°¤à°¿ à°ªà±‡à°°à±",
            price: "à°§à°°",
            description: "à°µà°¿à°µà°°à°£",
            uploadPhoto: "à°«à±‹à°Ÿà±‹à°¨à± à°…à°ªà±â€Œà°²à±‹à°¡à± à°šà±‡à°¯à°‚à°¡à°¿",
            postAd: "à°ªà±à°°à°•à°Ÿà°¨à°¨à± à°ªà±‹à°¸à±à°Ÿà± à°šà±‡à°¯à°‚à°¡à°¿",
            latestNews: "à°¤à°¾à°œà°¾ à°µà°¾à°°à±à°¤à°²à±",
            readMore: "à°‡à°‚à°•à°¾ à°šà°¦à°µà°‚à°¡à°¿"
        }
    };
    const t = (key) => translations[currentLanguage][key] || key;
    const dataHandler = {
        onDataChanged(data) {
            currentData = data;
            render();
        }
    };

    function generateDAN() {
        return Math.floor(100000000000 + Math.random() * 900000000000).toString();
    }

    function generateIoTData() {
        return {
            soilMoisture: Math.floor(30 + Math.random() * 40),
            temperature: Math.floor(20 + Math.random() * 15),
            humidity: Math.floor(40 + Math.random() * 40),
            pH: (6 + Math.random() * 2).toFixed(1)
        };
    }

    function getCropStatus(iotData) {
        if (iotData.soilMoisture < 40 || iotData.temperature > 32) {
            return {status: 'critical', text: t('critical')};
        } else if (iotData.soilMoisture < 50 || iotData.temperature > 28) {
            return {status: 'warning', text: t('needsAttention')};
        }
        return {status: 'healthy', text: t('healthy')};
    }

    async function handleLogin(portal, dan = null, password = null) {
        if (portal === 'admin') {
            if (password === 'admin123') {
                isLoading = true;
                currentView = 'loading';
                render();
                await new Promise(resolve => setTimeout(resolve, 5500));
                isLoading = false;
                currentPortal = 'admin';
                currentView = 'admin-dashboard';
                currentUser = {role: 'admin'};
                render();
            } else {
                showToast('Invalid password. Please try again.');
                return;
            }
        } else if (portal === 'farmer' && dan) {
            const farmer = currentData.find(d => d.type === 'farmer' && d.dan === dan);
            if (farmer) {
                isLoading = true;
                currentView = 'loading';
                render();
                await new Promise(resolve => setTimeout(resolve, 5500));
                isLoading = false;
                currentPortal = 'farmer';
                currentView = 'farmer-dashboard';
                currentUser = farmer;
                startIoTUpdates();
                render();
            } else {
                showToast('Invalid DAN. Please try again.');
                return;
            }
        }
    }

    function startIoTUpdates() {
        if (iotInterval) clearInterval(iotInterval);
        iotInterval = setInterval(() => {
            if (currentUser && currentUser.type === 'farmer') {
                const newIoT = generateIoTData();
                currentUser.soilMoisture = newIoT.soilMoisture;
                currentUser.temperature = newIoT.temperature;
                currentUser.humidity = newIoT.humidity;
                currentUser.pH = newIoT.pH;
                render();
            }
        }, 5000);
    }

    function handleLogout() {
        currentPortal = null;
        currentView = 'login';
        currentUser = null;
        if (iotInterval) clearInterval(iotInterval);
        render();
    }

    async function handleAddFarmer(formData) {
        const iotData = generateIoTData();
        const result = await window.dataSdk.create({
            type: 'farmer',
            dan: generateDAN(),
            name: formData.name,
            age: parseInt(formData.age),
            contact: formData.contact,
            location: formData.location,
            plotId: formData.plotId,
            area: parseFloat(formData.area),
            cropType: formData.cropType,
            soilType: formData.soilType,
            irrigation: formData.irrigation,
            ...iotData,
            timestamp: new Date().toISOString()
        });
        if (result.isOk) {
            showToast('Farmer added successfully!');
            currentView = 'admin-dashboard';
        } else {
            showToast('Error adding farmer. Please try again.');
        }
    }

    async function handleSendMessage(message) {
        if (!message.trim()) return;
        const result = await window.dataSdk.create({
            type: 'message',
            dan: currentUser.dan,
            message: message,
            sender: 'farmer',
            reply: '',
            status: 'pending',
            timestamp: new Date().toISOString()
        });
        if (result.isOk) {
            showToast('Message sent to admin!');
        } else {
            showToast('Error sending message.');
        }
    }

    async function handleReplyMessage(messageId, reply) {
        const message = currentData.find(d => d.id === messageId);
        if (message) {
            message.reply = reply;
            message.status = 'replied';
            const result = await window.dataSdk.update(message);
            if (result.isOk) {
                showToast('Reply sent successfully!');
            }
        }
    }

    function toggleDarkMode() {
        isDarkMode = !isDarkMode;
        document.body.classList.toggle('dark-mode', isDarkMode);
        render();
    }

    function toggleLanguage() {
        currentLanguage = currentLanguage === 'en' ? 'hi' : 'en';
        render();
    }

    function toggleChat() {
        isChatOpen = !isChatOpen;
        render();
    }

    function showToast(message) {
        const toast = document.createElement('div');
        toast.textContent = message;
        toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #4a7c2c;
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 1000;
        animation: fadeIn 0.3s ease;
      `;
        document.body.appendChild(toast);
        setTimeout(() => {
            toast.style.animation = 'fadeOut 0.3s ease';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    function renderLoginView() {
        return `
      <div class="min-h-full flex items-center justify-center p-4 gradient-bg" style="position: relative; overflow: hidden;">
        <div class="floating-particles">
          <div class="particle" style="left: 10%; top: 20%; animation-delay: 0s;">ðŸŒ±</div>
          <div class="particle" style="left: 80%; top: 30%; animation-delay: 2s;">ðŸŒ¾</div>
          <div class="particle" style="left: 20%; top: 70%; animation-delay: 4s;">ðŸƒ</div>
          <div class="particle" style="left: 70%; top: 60%; animation-delay: 6s;">ðŸŒ¿</div>
          <div class="particle" style="left: 50%; top: 40%; animation-delay: 3s;">ðŸŒ»</div>
          <div class="particle" style="left: 30%; top: 50%; animation-delay: 5s;">ðŸŒ¾</div>
          <div class="particle" style="left: 60%; top: 80%; animation-delay: 7s;">ðŸŒ±</div>
        </div>
        <div style="position: absolute; top: 10%; left: 5%; width: 300px; height: 300px; background: radial-gradient(circle, rgba(107, 157, 62, 0.2) 0%, transparent 70%); border-radius: 50%; animation: float 8s ease-in-out infinite;"></div>
        <div style="position: absolute; bottom: 10%; right: 5%; width: 400px; height: 400px; background: radial-gradient(circle, rgba(74, 124, 44, 0.15) 0%, transparent 70%); border-radius: 50%; animation: float 10s ease-in-out infinite reverse;"></div>
        <div class="max-w-md w-full" style="z-index: 10;">
          <div class="text-center text-white mb-8 fade-in">
            <svg width="120" height="120" viewBox="0 0 200 200" class="mx-auto mb-4" style="filter: drop-shadow(0 10px 30px rgba(0,0,0,0.3)); animation: float 6s ease-in-out infinite;">
              <defs>
                <linearGradient id="plantGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:#a5d6a7;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#4a7c2c;stop-opacity:1" />
                </linearGradient>
              </defs>
              <circle cx="100" cy="100" r="90" fill="rgba(255,255,255,0.1)" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
              <path d="M100 40 Q80 70 100 100 Q120 70 100 40" fill="url(#plantGradient)">
                <animateTransform attributeName="transform" type="rotate" from="0 100 100" to="10 100 100" dur="2s" repeatCount="indefinite" />
              </path>
              <path d="M100 100 Q70 120 100 160 Q130 120 100 100" fill="url(#plantGradient)">
                <animateTransform attributeName="transform" type="rotate" from="0 100 100" to="-10 100 100" dur="2s" repeatCount="indefinite" />
              </path>
              <rect x="96" y="100" width="8" height="60" fill="#8b4513" rx="4"/>
              <circle cx="60" cy="60" r="15" fill="#ffd700" opacity="0.9">
                <animate attributeName="opacity" values="0.7;1;0.7" dur="3s" repeatCount="indefinite" />
              </circle>
              <path d="M60 45 L60 55 M60 65 L60 75 M45 60 L55 60 M65 60 L75 60" stroke="#ffd700" stroke-width="3" stroke-linecap="round">
                <animate attributeName="opacity" values="0.5;1;0.5" dur="3s" repeatCount="indefinite" />
              </path>
            </svg>
            <h1 class="text-4xl font-bold mb-2" style="text-shadow: 2px 2px 10px rgba(0,0,0,0.3);">
              ${window.elementSdk?.config?.app_title || defaultConfig.app_title}
            </h1>
            <p class="text-lg" style="text-shadow: 1px 1px 5px rgba(0,0,0,0.3);">
              ${window.elementSdk?.config?.app_tagline || defaultConfig.app_tagline}
            </p>
          </div>
          <!-- Language Selector -->
          <div class="mb-6 text-center">
            <div class="language-selector">
              <button onclick="setLanguage('en')" class="language-btn-small ${currentLanguage === 'en' ? 'active' : ''}">English</button>
              <button onclick="setLanguage('hi')" class="language-btn-small ${currentLanguage === 'hi' ? 'active' : ''}">à¤¹à¤¿à¤‚à¤¦à¥€</button>
              <button onclick="setLanguage('kn')" class="language-btn-small ${currentLanguage === 'kn' ? 'active' : ''}">à²•à²¨à³à²¨à²¡</button>
              <button onclick="setLanguage('ml')" class="language-btn-small ${currentLanguage === 'ml' ? 'active' : ''}">à´®à´²à´¯à´¾à´³à´‚</button>
              <button onclick="setLanguage('ta')" class="language-btn-small ${currentLanguage === 'ta' ? 'active' : ''}">à®¤à®®à®¿à®´à¯</button>
              <button onclick="setLanguage('te')" class="language-btn-small ${currentLanguage === 'te' ? 'active' : ''}">à°¤à±†à°²à±à°—à±</button>
            </div>
          </div>
          <!-- Portal Toggle -->
          <div class="mb-6 flex justify-center">
            <div class="portal-toggle" onclick="togglePortalType()">
              <div class="portal-toggle-slider ${loginPortalType === 'admin' ? 'admin' : ''}"></div>
              <div class="portal-option ${loginPortalType === 'farmer' ? 'active' : ''}">
                ðŸ‘¨â€ðŸŒ¾ ${t('farmerPortal')}
              </div>
              <div class="portal-option ${loginPortalType === 'admin' ? 'active' : ''}">
                ðŸŒ¾ ${t('adminPortal')}
              </div>
            </div>
          </div>
          <!-- Login Card -->
          <div class="card p-8 fade-in">
            ${loginPortalType === 'farmer' ? `
            <form onsubmit="handleFarmerLoginSubmit(event)" class="space-y-4">
              <div>
                <label class="block mb-2 font-semibold" style="color: ${window.elementSdk?.config?.text_color || defaultConfig.text_color}">
                  ðŸ†” ${t('enterDAN')}
                </label>
                <input type="text" id="danInput" placeholder="${t('enterDAN')}" maxlength="12" required class="input-field" />
              </div>
              <button type="submit" class="btn btn-primary w-full">
                ${t('login')} â†’
              </button>
            </form>
            ` : `
            <form onsubmit="handleAdminLoginSubmit(event)" class="space-y-4">
              <div>
                <label class="block mb-2 font-semibold" style="color: ${window.elementSdk?.config?.text_color || defaultConfig.text_color}">
                  ðŸ” ${t('password')}
                </label>
                <input type="password" id="adminPassword" placeholder="${t('enterPassword')}" required class="input-field" />
                <p class="text-xs text-gray-500 mt-1">Default: admin123</p>
              </div>
              <button type="submit" class="btn btn-primary w-full">
                ${t('login')} â†’
              </button>
            </form>
            `}
          </div>
        </div>
      </div>
    `;
    }

    function renderAdminDashboard() {
        const farmers = currentData.filter(d => d.type === 'farmer');
        const messages = currentData.filter(d => d.type === 'message');
        const languageNames = {
            en: 'English',
            hi: 'à¤¹à¤¿à¤‚à¤¦à¥€',
            kn: 'à²•à²¨à³à²¨à²¡',
            ml: 'à´®à´²à´¯à´¾à´³à´‚',
            ta: 'à®¤à®®à®¿à®´à¯',
            te: 'à°¤à±†à°²à±à°—à±'
        };
        return `
      <div class="min-h-full ${isDarkMode ? 'dark-mode' : 'gradient-bg-light'}">
        <nav class="card mx-4 mt-4 p-4 flex justify-between items-center flex-wrap gap-4" style="z-index: 10000; position: relative;">
          <h1 class="text-2xl font-bold" style="color: ${window.elementSdk?.config?.primary_color || defaultConfig.primary_color}">
            ${window.elementSdk?.config?.app_title || defaultConfig.app_title} - Admin
          </h1>
          <div class="flex gap-3 items-center flex-wrap">
            <button onclick="currentView='admin-dashboard'; render()" class="btn btn-secondary">
              ðŸ“Š ${t('dashboard')}
            </button>
            <button onclick="currentView='add-farmer'; render()" class="btn btn-secondary">
              âž• ${t('addFarmer')}
            </button>
            <div class="language-dropdown">
              <button class="language-dropdown-button" onclick="toggleLanguageDropdown(event)">
                ðŸŒ ${languageNames[currentLanguage]}
                <span style="font-size: 10px;">â–¼</span>
              </button>
              <div class="language-dropdown-menu" id="languageMenu">
                <div class="language-option ${currentLanguage === 'en' ? 'active' : ''}" onclick="setLanguageAndClose('en')">
                  ðŸ‡¬ðŸ‡§ English
                </div>
                <div class="language-option ${currentLanguage === 'hi' ? 'active' : ''}" onclick="setLanguageAndClose('hi')">
                  ðŸ‡®ðŸ‡³ à¤¹à¤¿à¤‚à¤¦à¥€
                </div>
                <div class="language-option ${currentLanguage === 'kn' ? 'active' : ''}" onclick="setLanguageAndClose('kn')">
                  ðŸ‡®ðŸ‡³ à²•à²¨à³à²¨à²¡
                </div>
                <div class="language-option ${currentLanguage === 'ml' ? 'active' : ''}" onclick="setLanguageAndClose('ml')">
                  ðŸ‡®ðŸ‡³ à´®à´²à´¯à´¾à´³à´‚
                </div>
                <div class="language-option ${currentLanguage === 'ta' ? 'active' : ''}" onclick="setLanguageAndClose('ta')">
                  ðŸ‡®ðŸ‡³ à®¤à®®à®¿à®´à¯
                </div>
                <div class="language-option ${currentLanguage === 'te' ? 'active' : ''}" onclick="setLanguageAndClose('te')">
                  ðŸ‡®ðŸ‡³ à°¤à±†à°²à±à°—à±
                </div>
              </div>
            </div>
            <div class="theme-toggle" onclick="toggleDarkMode()">
              <div class="theme-toggle-slider">
                ${isDarkMode ? 'ðŸŒ™' : 'â˜€ï¸'}
              </div>
            </div>
            <button onclick="handleLogout()" class="btn btn-primary">
              ðŸšª ${t('logout')}
            </button>
          </div>
        </nav>
        <div class="p-6">
          ${currentView === 'admin-dashboard' ? renderAdminDashboardContent(farmers) : ''}
          ${currentView === 'add-farmer' ? renderAddFarmerForm() : ''}
        </div>
        ${renderChatFAB(messages)}
        ${isChatOpen ? renderChatModal(messages) : ''}
      </div>
    `;
    }

    function renderAdminDashboardContent(farmers) {
        return `
      <div class="space-y-6 fade-in">
        <div class="card p-6" style="position: relative; overflow: visible;">
          <div style="position: absolute; top: -15px; right: 15px; font-size: 50px; opacity: 0.15; animation: rotate-scale 4s ease-in-out infinite;">
            ðŸŒ
          </div>
          <h2 class="text-2xl font-bold mb-4">${window.elementSdk?.config?.admin_welcome || defaultConfig.admin_welcome}</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="iot-card">
              <div class="text-3xl mb-2">ðŸ‘¨â€ðŸŒ¾</div>
              <div class="text-2xl font-bold">${farmers.length}</div>
              <div class="text-sm text-gray-600">Total Farmers</div>
            </div>
            <div class="iot-card">
              <div class="text-3xl mb-2">ðŸŒ¾</div>
              <div class="text-2xl font-bold">${farmers.reduce((sum, f) => sum + (f.area || 0), 0).toFixed(1)}</div>
              <div class="text-sm text-gray-600">Total Area (acres)</div>
            </div>
            <div class="iot-card">
              <div class="text-3xl mb-2">ðŸ’§</div>
              <div class="text-2xl font-bold">${farmers.length > 0 ? (farmers.reduce((sum, f) => sum + (f.soilMoisture || 0), 0) / farmers.length).toFixed(0) : 0}%</div>
              <div class="text-sm text-gray-600">Avg Soil Moisture</div>
            </div>
          </div>
        </div>
        <div class="card p-6">
          <h3 class="text-xl font-bold mb-4">${t('allFarmers')}</h3>
          <input type="text" id="searchInput" placeholder="${t('search')}" class="input-field mb-4" oninput="filterFarmers(this.value)" />
          <div class="scroll-container">
            <table class="w-full">
              <thead>
                <tr class="border-b-2">
                  <th class="text-left p-3">DAN</th>
                  <th class="text-left p-3">${t('name')}</th>
                  <th class="text-left p-3">${t('location')}</th>
                  <th class="text-left p-3">${t('cropType')}</th>
                  <th class="text-left p-3">${t('soilMoisture')}</th>
                  <th class="text-left p-3">Status</th>
                </tr>
              </thead>
              <tbody id="farmersTable">
                ${farmers.map(f => {
            const status = getCropStatus(f);
            return `
                  <tr class="border-b hover:bg-gray-50 transition-all duration-300" style="cursor: pointer;">
                    <td class="p-3 font-mono text-sm">${f.dan}</td>
                    <td class="p-3 font-semibold">${f.name}</td>
                    <td class="p-3">ðŸ“ ${f.location}</td>
                    <td class="p-3">ðŸŒ¾ ${f.cropType}</td>
                    <td class="p-3">
                      <div style="display: inline-block; padding: 4px 12px; background: rgba(107, 157, 62, 0.2); border-radius: 12px; font-weight: 600;">
                        ðŸ’§ ${f.soilMoisture}%
                      </div>
                    </td>
                    <td class="p-3">
                      <span class="status-${status.status}" style="font-size: 20px;">â—</span>
                      <span style="font-weight: 600;">${status.text}</span>
                    </td>
                  </tr>
                `;
        }).join('')}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    `;
    }

    function renderAddFarmerForm() {
        return `
      <div class="card p-6 max-w-2xl mx-auto fade-in">
        <h2 class="text-2xl font-bold mb-6">${t('addFarmer')}</h2>
        <form onsubmit="handleAddFarmerSubmit(event)" class="space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block mb-2 font-semibold">${t('name')}</label>
              <input type="text" name="name" required class="input-field" />
            </div>
            <div>
              <label class="block mb-2 font-semibold">${t('age')}</label>
              <input type="number" name="age" required class="input-field" />
            </div>
            <div>
              <label class="block mb-2 font-semibold">${t('contact')}</label>
              <input type="tel" name="contact" required class="input-field" />
            </div>
            <div>
              <label class="block mb-2 font-semibold">${t('location')}</label>
              <input type="text" name="location" required class="input-field" />
            </div>
            <div>
              <label class="block mb-2 font-semibold">${t('plotId')}</label>
              <input type="text" name="plotId" required class="input-field" />
            </div>
            <div>
              <label class="block mb-2 font-semibold">${t('area')}</label>
              <input type="number" step="0.1" name="area" required class="input-field" />
            </div>
            <div>
              <label class="block mb-2 font-semibold">${t('cropType')}</label>
              <input type="text" name="cropType" required class="input-field" />
            </div>
            <div>
              <label class="block mb-2 font-semibold">${t('soilType')}</label>
              <input type="text" name="soilType" required class="input-field" />
            </div>
            <div>
              <label class="block mb-2 font-semibold">${t('irrigation')}</label>
              <input type="text" name="irrigation" required class="input-field" />
            </div>
          </div>
          <div class="flex gap-4 mt-6">
            <button type="submit" class="btn btn-primary flex-1">${t('save')}</button>
            <button type="button" onclick="currentView='admin-dashboard'; render()" class="btn btn-secondary flex-1">
              ${t('cancel')}
            </button>
          </div>
        </form>
      </div>
    `;
    }

    function renderChatFAB(messages) {
        const pendingCount = messages.filter(m => m.status === 'pending').length;
        return `
      <div class="chat-fab" onclick="toggleChat()">
        ðŸ’¬
        ${pendingCount > 0 ? `<div class="chat-fab-badge">${pendingCount}</div>` : ''}
      </div>
    `;
    }

    function renderChatModal(messages) {
        const groupedMessages = {};
        messages.forEach(msg => {
            if (!groupedMessages[msg.dan]) {
                groupedMessages[msg.dan] = [];
            }
            groupedMessages[msg.dan].push(msg);
        });
        return `
      <div class="chat-modal">
        <div class="chat-modal-header">
          <div>
            <h3 class="font-bold text-lg">ðŸ’¬ ${t('chatSupport')}</h3>
            <p class="text-xs opacity-80">${Object.keys(groupedMessages).length} conversation(s)</p>
          </div>
          <button class="chat-close-btn" onclick="toggleChat()">âœ•</button>
        </div>
        <div class="chat-modal-body">
          ${Object.keys(groupedMessages).length === 0 ? `<p class="text-center text-gray-500 py-8">${t('noMessages')}</p>` :
            `${Object.entries(groupedMessages).map(([dan, msgs]) => {
                const farmer = currentData.find(d => d.type === 'farmer' && d.dan === dan);
                return `
              <div class="card p-3 mb-2">
                <h4 class="font-bold mb-2 text-sm">ðŸ‘¨â€ðŸŒ¾ ${farmer?.name || 'Unknown'}</h4>
                <div class="space-y-2">
                  ${msgs.map(msg => `
                  <div class="border-l-4 border-green-500 pl-3 py-2">
                    <p class="text-sm mb-1">${msg.message}</p>
                    <p class="text-xs text-gray-500">${new Date(msg.timestamp).toLocaleString()}</p>
                    ${msg.reply ? `
                    <div class="mt-2 bg-green-50 p-2 rounded">
                      <p class="text-xs"><strong>Admin:</strong> ${msg.reply}</p>
                    </div>
                    ` : `
                    <div class="mt-2">
                      <input type="text" id="reply-${msg.__backendId}" placeholder="${t('typeMessage')}" class="input-field text-sm mb-1" style="padding: 8px 12px;" />
                      <button onclick="handleAdminReply('${msg.__backendId}')" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;">
                        ${t('reply')}
                      </button>
                    </div>
                    `}
                  </div>
                  `).join('')}
                </div>
              </div>
            `;
            }).join('')}
          `}
        </div>
      </div>
    `;
    }

    function renderFarmerChatModal(messages) {
        return `
      <div class="chat-modal">
        <div class="chat-modal-header">
          <div>
            <h3 class="font-bold text-lg">ðŸ’¬ ${t('chatSupport')}</h3>
            <p class="text-xs opacity-80">Chat with Admin</p>
          </div>
          <button class="chat-close-btn" onclick="toggleChat()">âœ•</button>
        </div>
        <div class="chat-modal-body">
          ${messages.length === 0 ? `<p class="text-center text-gray-500 py-4 text-sm">${t('noMessages')}</p>` :
            messages.map(msg => `
            <div class="chat-bubble chat-bubble-farmer">
              <p class="mb-1 text-sm">${msg.message}</p>
              <p class="text-xs opacity-70">${new Date(msg.timestamp).toLocaleString()}</p>
              ${msg.reply ? `
              <div class="mt-2 pt-2 border-t">
                <p class="text-xs"><strong>Admin:</strong> ${msg.reply}</p>
              </div>
              ` : ''}
            </div>
            `).join('')}
        </div>
        <div class="chat-modal-footer">
          <input type="text" id="chatInput" placeholder="${t('typeMessage')}" class="input-field flex-1" style="padding: 10px 12px;" />
          <button onclick="handleSendChatMessage()" class="btn btn-primary" style="padding: 10px 16px;">
            âž¤
          </button>
        </div>
      </div>
    `;
    }

    function renderFarmerDashboard() {
        const messages = currentData.filter(d => d.type === 'message' && d.dan === currentUser.dan);
        const languageNames = {
            en: 'English',
            hi: 'à¤¹à¤¿à¤‚à¤¦à¥€',
            kn: 'à²•à²¨à³à²¨à²¡',
            ml: 'à´®à´²à´¯à´¾à´³à´‚',
            ta: 'à®¤à®®à®¿à®´à¯',
            te: 'à°¤à±†à°²à±à°—à±'
        };
        return `
      <div class="min-h-full ${isDarkMode ? 'dark-mode' : 'gradient-bg-light'}">
        <nav class="card mx-4 mt-4 p-4 flex justify-between items-center flex-wrap gap-4" style="z-index: 10000; position: relative;">
          <h1 class="text-2xl font-bold" style="color: ${window.elementSdk?.config?.primary_color || defaultConfig.primary_color}">
            ${window.elementSdk?.config?.app_title || defaultConfig.app_title}
          </h1>
          <div class="flex gap-3 items-center flex-wrap">
            <button onclick="currentView='farmer-dashboard'; render()" class="btn btn-secondary">
              ðŸ“Š ${t('dashboard')}
            </button>
            <button onclick="currentView='marketplace'; render()" class="btn btn-secondary">
              ðŸ›ï¸ ${t('marketplace')}
            </button>
            <button onclick="currentView='news'; render()" class="btn btn-secondary">
              ðŸ“° ${t('news')}
            </button>
            <div class="language-dropdown">
              <button class="language-dropdown-button" onclick="toggleLanguageDropdown(event)">
                ðŸŒ ${languageNames[currentLanguage]}
                <span style="font-size: 10px;">â–¼</span>
              </button>
              <div class="language-dropdown-menu" id="languageMenu">
                <div class="language-option ${currentLanguage === 'en' ? 'active' : ''}" onclick="setLanguageAndClose('en')">
                  ðŸ‡¬ðŸ‡§ English
                </div>
                <div class="language-option ${currentLanguage === 'hi' ? 'active' : ''}" onclick="setLanguageAndClose('hi')">
                  ðŸ‡®ðŸ‡³ à¤¹à¤¿à¤‚à¤¦à¥€
                </div>
                <div class="language-option ${currentLanguage === 'kn' ? 'active' : ''}" onclick="setLanguageAndClose('kn')">
                  ðŸ‡®ðŸ‡³ à²•à²¨à³à²¨à²¡
                </div>
                <div class="language-option ${currentLanguage === 'ml' ? 'active' : ''}" onclick="setLanguageAndClose('ml')">
                  ðŸ‡®ðŸ‡³ à´®à´²à´¯à´¾à´³à´‚
                </div>
                <div class="language-option ${currentLanguage === 'ta' ? 'active' : ''}" onclick="setLanguageAndClose('ta')">
                  ðŸ‡®ðŸ‡³ à®¤à®®à®¿à®´à¯
                </div>
                <div class="language-option ${currentLanguage === 'te' ? 'active' : ''}" onclick="setLanguageAndClose('te')">
                  ðŸ‡®ðŸ‡³ à°¤à±†à°²à±à°—à±
                </div>
              </div>
            </div>
            <div class="theme-toggle" onclick="toggleDarkMode()">
              <div class="theme-toggle-slider">
                ${isDarkMode ? 'ðŸŒ™' : 'â˜€ï¸'}
              </div>
            </div>
            <button onclick="handleLogout()" class="btn btn-primary">
              ðŸšª ${t('logout')}
            </button>
          </div>
        </nav>
        <div class="p-6">
          ${currentView === 'farmer-dashboard' ? renderFarmerDashboardContent() : ''}
          ${currentView === 'marketplace' ? renderMarketplace() : ''}
          ${currentView === 'news' ? renderNews() : ''}
        </div>
        ${renderChatFAB(messages)}
        ${isChatOpen ? renderFarmerChatModal(messages) : ''}
      </div>
    `;
    }

    function renderFarmerDashboardContent() {
        const status = getCropStatus(currentUser);
        return `
      <div class="space-y-6 fade-in">
        <div class="card p-6" style="position: relative; overflow: visible;">
          <div style="position: absolute; top: -20px; right: 20px; font-size: 60px; opacity: 0.2; animation: bounce 3s ease-in-out infinite;">
            ðŸšœ
          </div>
          <h2 class="text-2xl font-bold mb-2">${window.elementSdk?.config?.farmer_welcome || defaultConfig.farmer_welcome}, ${currentUser.name}!</h2>
          <p class="text-gray-600">DAN: ${currentUser.dan}</p>
        </div>
        <div class="card p-6">
          <h3 class="text-xl font-bold mb-4">${t('cropCondition')}</h3>
          <div class="flex items-center gap-4 mb-4">
            <div class="crop-status-icon">
              ${status.status === 'healthy' ? 'âœ…' : status.status === 'warning' ? 'âš ï¸' : 'ðŸš¨'}
            </div>
            <div>
              <div class="text-2xl font-bold status-${status.status}">${status.text}</div>
              <p class="text-sm text-gray-600">${currentUser.cropType} - ${currentUser.area} acres</p>
            </div>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="iot-card">
            <div class="text-3xl mb-2">ðŸ’§</div>
            <div class="text-2xl font-bold">${currentUser.soilMoisture}%</div>
            <div class="text-sm">${t('soilMoisture')}</div>
          </div>
          <div class="iot-card">
            <div class="text-3xl mb-2">ðŸŒ¡ï¸</div>
            <div class="text-2xl font-bold">${currentUser.temperature}Â°C</div>
            <div class="text-sm">${t('temperature')}</div>
          </div>
          <div class="iot-card">
            <div class="text-3xl mb-2">ðŸ’¨</div>
            <div class="text-2xl font-bold">${currentUser.humidity}%</div>
            <div class="text-sm">${t('humidity')}</div>
          </div>
          <div class="iot-card">
            <div class="text-3xl mb-2">âš—ï¸</div>
            <div class="text-2xl font-bold">${currentUser.pH}</div>
            <div class="text-sm">${t('pH')}</div>
          </div>
        </div>
      </div>
    `;
    }

    function renderMarketplace() {
        return `
      <div class="space-y-6 fade-in">
        <div class="card p-6">
          <h2 class="text-2xl font-bold mb-4">ðŸ›ï¸ ${t('marketplace')}</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div>
              <h3 class="text-xl font-bold mb-4">${t('sellYourGoods')}</h3>
              <form class="space-y-4">
                <div>
                  <label class="block mb-2 font-semibold">${t('productName')}</label>
                  <input type="text" required class="input-field" />
                </div>
                <div>
                  <label class="block mb-2 font-semibold">${t('price')}</label>
                  <input type="number" step="0.01" required class="input-field" />
                </div>
                <div>
                  <label class="block mb-2 font-semibold">${t('description')}</label>
                  <textarea rows="3" class="input-field"></textarea>
                </div>
                <div>
                  <label class="block mb-2 font-semibold">${t('uploadPhoto')}</label>
                  <input type="file" class="input-field" />
                </div>
                <button type="submit" class="btn btn-primary w-full">${t('postAd')}</button>
              </form>
            </div>
            <div>
              <h3 class="text-xl font-bold mb-4">${t('buyGoods')}</h3>
              <div class="space-y-4">
                <div class="card p-4 flex gap-4 items-center">
                  <img src="https://via.placeholder.com/80" alt="Product" class="rounded-lg" />
                  <div>
                    <h4 class="font-bold">Organic Fertilizers</h4>
                    <p class="text-sm text-gray-600">High-quality compost for all crops.</p>
                    <p class="font-bold mt-2">$20.00</p>
                  </div>
                </div>
                <div class="card p-4 flex gap-4 items-center">
                  <img src="https://via.placeholder.com/80" alt="Product" class="rounded-lg" />
                  <div>
                    <h4 class="font-bold">Hybrid Seeds</h4>
                    <p class="text-sm text-gray-600">High-yield tomato seeds.</p>
                    <p class="font-bold mt-2">$15.00</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    `;
    }

    function renderNews() {
        return `
      <div class="space-y-6 fade-in">
        <div class="card p-6">
          <h2 class="text-2xl font-bold mb-4">ðŸ“° ${t('latestNews')}</h2>
          <div class="space-y-4">
            <div class="card p-4">
              <h3 class="font-bold">New Government Scheme for Farmers</h3>
              <p class="text-sm text-gray-600 mb-2">The government announced a new subsidy scheme for small-scale farmers to promote organic farming...</p>
              <a href="#" class="text-sm font-bold text-green-600">${t('readMore')}</a>
            </div>
            <div class="card p-4">
              <h3 class="font-bold">Weather Alert: Heavy Rains Expected</h3>
              <p class="text-sm text-gray-600 mb-2">The meteorological department has issued a warning for heavy rainfall in the northern regions over the next 48 hours...</p>
              <a href="#" class="text-sm font-bold text-green-600">${t('readMore')}</a>
            </div>
            <div class="card p-4">
              <h3 class="font-bold">Market Prices for Wheat on the Rise</h3>
              <p class="text-sm text-gray-600 mb-2">An increase in demand has led to a sharp rise in the market price for wheat and other essential grains...</p>
              <a href="#" class="text-sm font-bold text-green-600">${t('readMore')}</a>
            </div>
          </div>
        </div>
      </div>
    `;
    }

    function renderLoadingScreen() {
        return `
      <div class="loading-screen">
        <div class="tree-animation">
          <div class="seedling-container">
            <div class="soil-line"></div>
            <div class="seed"></div>
            <div class="sprout"></div>
            <div class="first-leaves">
              <div class="leaf-left"></div>
              <div class="leaf-right"></div>
            </div>
            <div class="mature-plant">
              <div class="plant-crown">
                <div class="crown-leaf"></div>
                <div class="crown-leaf"></div>
                <div class="crown-leaf"></div>
                <div class="crown-leaf"></div>
                <div class="crown-leaf"></div>
                <div class="flower-bloom">
                  <div class="petal"></div>
                  <div class="petal"></div>
                  <div class="petal"></div>
                  <div class="petal"></div>
                  <div class="petal"></div>
                  <div class="flower-center"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="loading-text">ðŸŒ± Growing your dashboard...</div>
      </div>
    `;
    }

    function render() {
        const app = document.getElementById('app');
        let html = '';
        if (isLoading) {
            html = renderLoadingScreen();
        } else if (currentView === 'login') {
            html = renderLoginView();
        } else if (currentPortal === 'admin') {
            html = renderAdminDashboard();
        } else if (currentPortal === 'farmer') {
            html = renderFarmerDashboard();
        }
        app.innerHTML = html;
    }

    window.togglePortalType = () => {
        loginPortalType = loginPortalType === 'farmer' ? 'admin' : 'farmer';
        render();
    };
    window.setLanguage = (lang) => {
        currentLanguage = lang;
        render();
    };
    window.toggleLanguageDropdown = (event) => {
        event.stopPropagation();
        const menu = document.getElementById('languageMenu');
        if (menu) {
            menu.classList.toggle('open');
        }
    };
    window.setLanguageAndClose = (lang) => {
        currentLanguage = lang;
        const menu = document.getElementById('languageMenu');
        if (menu) {
            menu.classList.remove('open');
        }
        render();
    };
    document.addEventListener('click', (event) => {
        const menu = document.getElementById('languageMenu');
        const dropdown = document.querySelector('.language-dropdown');
        if (menu && dropdown && !dropdown.contains(event.target)) {
            menu.classList.remove('open');
        }
    });
    window.handleAdminLoginSubmit = (e) => {
        e.preventDefault();
        const password = document.getElementById('adminPassword').value;
        handleLogin('admin', null, password);
    };
    window.handleFarmerLoginSubmit = (e) => {
        e.preventDefault();
        const dan = document.getElementById('danInput').value;
        if (dan.length === 12) {
            handleLogin('farmer', dan);
        } else {
            showToast('Please enter a valid 12-digit DAN');
        }
    };
    window.handleFarmerLogin = () => {
        const dan = document.getElementById('danInput').value;
        if (dan.length === 12) {
            handleLogin('farmer', dan);
        } else {
            showToast('Please enter a valid 12-digit DAN');
        }
    };
    window.handleAddFarmerSubmit = (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);
        handleAddFarmer(data);
    };
    window.handleSendChatMessage = () => {
        const input = document.getElementById('chatInput');
        if (input && input.value.trim()) {
            handleSendMessage(input.value);
            input.value = '';
        }
    };
    window.handleAdminReply = async (messageId) => {
        const input = document.getElementById(`reply-${messageId}`);
        if (input && input.value.trim()) {
            const message = currentData.find(d => d.__backendId === messageId);
            if (message) {
                message.reply = input.value;
                message.status = 'replied';
                const result = await window.dataSdk.update(message);
                if (result.isOk) {
                    showToast('Reply sent successfully!');
                } else {
                    showToast('Error sending reply.');
                }
            }
        }
    };
    window.filterFarmers = (searchTerm) => {
        const farmers = currentData.filter(d => d.type === 'farmer');
        const filtered = farmers.filter(f => f.dan.includes(searchTerm) || f.name.toLowerCase().includes(searchTerm.toLowerCase()));
        const tbody = document.getElementById('farmersTable');
        if (tbody) {
            tbody.innerHTML = filtered.map(f => {
                const status = getCropStatus(f);
                return `
              <tr class="border-b hover:bg-gray-50">
                <td class="p-3 font-mono text-sm">${f.dan}</td>
                <td class="p-3">${f.name}</td>
                <td class="p-3">${f.location}</td>
                <td class="p-3">${f.cropType}</td>
                <td class="p-3">${f.soilMoisture}%</td>
                <td class="p-3">
                  <span class="status-${status.status}">â—</span> ${status.text}
                </td>
              </tr>
            `;
            }).join('');
        }
    };

    async function onConfigChange(config) {
        const titleElements = document.querySelectorAll('h1');
        titleElements.forEach(el => {
            if (el.textContent.includes('KrishiSetu') || el.textContent.includes(defaultConfig.app_title)) {
                el.textContent = config.app_title || defaultConfig.app_title;
            }
        });
        const primaryColorElements = document.querySelectorAll('[style*="color"]');
        primaryColorElements.forEach(el => {
            if (el.style.color === defaultConfig.primary_color || el.style.color === config.primary_color) {
                el.style.color = config.primary_color || defaultConfig.primary_color;
            }
        });
        render();
    }

    async function init() {
        if (typeof window.dataSdk === 'undefined') {
            console.error('Data SDK not found. Using mock data.');
            window.dataSdk = {
                init: () => ({ isOk: true }),
                create: (data) => {
                    console.log('Mock create:', data);
                    return { isOk: true };
                },
                update: (data) => {
                    console.log('Mock update:', data);
                    return { isOk: true };
                }
            };
        }
        const initResult = await window.dataSdk.init(dataHandler);
        if (!initResult.isOk) {
            console.error('Failed to initialize Data SDK');
            return;
        }
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities: (config) => ({
                    recolorables: [
                        {
                            get: () => config.primary_color || defaultConfig.primary_color,
                            set: (value) => {
                                config.primary_color = value;
                                window.elementSdk.setConfig({primary_color: value});
                            }
                        },
                        {
                            get: () => config.secondary_color || defaultConfig.secondary_color,
                            set: (value) => {
                                config.secondary_color = value;
                                window.elementSdk.setConfig({secondary_color: value});
                            }
                        },
                        {
                            get: () => config.background_color || defaultConfig.background_color,
                            set: (value) => {
                                config.background_color = value;
                                window.elementSdk.setConfig({background_color: value});
                            }
                        },
                        {
                            get: () => config.text_color || defaultConfig.text_color,
                            set: (value) => {
                                config.text_color = value;
                                window.elementSdk.setConfig({text_color: value});
                            }
                        },
                        {
                            get: () => config.accent_color || defaultConfig.accent_color,
                            set: (value) => {
                                config.accent_color = value;
                                window.elementSdk.setConfig({accent_color: value});
                            }
                        }
                    ],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined
                }),
                mapToEditPanelValues: (config) => new Map([
                    ['app_title', config.app_title || defaultConfig.app_title],
                    ['app_tagline', config.app_tagline || defaultConfig.app_tagline],
                    ['admin_welcome', config.admin_welcome || defaultConfig.admin_welcome],
                    ['farmer_welcome', config.farmer_welcome || defaultConfig.farmer_welcome]
                ])
            });
        }
        render();
    }

    init();
</script>
</body>
</html>

